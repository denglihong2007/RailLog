@page "/my-trips"
@using Microsoft.AspNetCore.Authorization
@using System.Security.Claims
@using RailLog.Shared.Models
@attribute [Authorize]
@rendermode InteractiveWebAssembly
@inject HttpClient Http

<PageTitle>æˆ‘çš„è¿è½¬æ—¥å¿—</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
    <div class="d-flex justify-space-between align-center mb-4">
        <MudText Typo="Typo.h4">ğŸš„ æˆ‘çš„è¿è½¬æ—¥å¿—</MudText>
        <MudButton Variant="Variant.Filled" Color="Color.Success" StartIcon="@Icons.Material.Filled.Add" Href="/add-trip">æ–°å¢è¡Œç¨‹</MudButton>
    </div>

    @if (trips == null)
    {
        <div class="d-flex flex-column align-center">
            <MudProgressCircular Color="Color.Primary" Indeterminate="true" Size="Size.Large" />
            <MudText Class="mt-2">æ­£åœ¨åŠªåŠ›åŠ è½½ä½ çš„è¡Œç¨‹è®°å½•...</MudText>
        </div>
    }
    else if (!trips.Any())
    {
        <MudAlert Severity="Severity.Info">ä½ è¿˜æ²¡æœ‰å½•å…¥è¿‡è¡Œç¨‹è®°å½•å“¦ï¼Œå¿«å»æ·»åŠ ä¸€æ¡å§ï¼</MudAlert>
    }
    else
    {
        <MudTable Items="@trips" Hover="true" Breakpoint="Breakpoint.Sm" Elevation="1">
            <HeaderContent>
                <MudTh>æ—¥æœŸ</MudTh>
                <MudTh>è½¦æ¬¡</MudTh>
                <MudTh>åŒºé—´</MudTh>
                <MudTh>å¸­åˆ«</MudTh>
                <MudTh>ç¥¨ä»·</MudTh>
                <MudTh>å¤‡æ³¨</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="æ—¥æœŸ">@context.TravelDate.ToString("yyyy-MM-dd")</MudTd>
                <MudTd DataLabel="è½¦æ¬¡">
                    <MudChip T="string" Color="Color.Primary" Size="Size.Small">@context.TrainNumber</MudChip>
                </MudTd>
                <MudTd DataLabel="åŒºé—´">@context.FromStation â” @context.ToStation</MudTd>
                <MudTd DataLabel="å¸­åˆ«">@context.SeatType @context.SeatNumber</MudTd>
                <MudTd DataLabel="ç¥¨ä»·">Â¥@context.Price</MudTd>
                <MudTd DataLabel="å¤‡æ³¨">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">@context.Notes</MudText>
                </MudTd>
            </RowTemplate>
        </MudTable>
    }
</MudContainer>

@code {
    private List<TripRecordDto>? trips;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            trips = await Http.GetFromJsonAsync<List<TripRecordDto>>("api/trips");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"åŠ è½½å¤±è´¥: {ex.Message}");
        }
    }
}
