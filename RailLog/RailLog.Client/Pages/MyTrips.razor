@page "/my-trips"
@using Microsoft.AspNetCore.Authorization
@using System.Security.Claims
@using RailLog.Shared.Models
@attribute [Authorize]
@rendermode InteractiveWebAssembly
@inject HttpClient Http

<PageTitle>我的运转日志</PageTitle>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>🚄 我的运转日志</h3>
        <a href="/add-trip" class="btn btn-success">新增行程</a>
    </div>

    @if (trips == null)
    {
        <div class="text-center">
            <div class="spinner-border text-primary" role="status"></div>
            <p>正在努力加载你的行程记录...</p>
        </div>
    }
    else if (!trips.Any())
    {
        <div class="alert alert-info">你还没有录入过行程记录哦，快去添加一条吧！</div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>日期</th>
                        <th>车次</th>
                        <th>区间</th>
                        <th>席别</th>
                        <th>票价</th>
                        <th>备注</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var trip in trips)
                    {
                        <tr>
                            <td>@trip.TravelDate.ToString("yyyy-MM-dd")</td>
                            <td><span class="badge bg-primary">@trip.TrainNumber</span></td>
                            <td>@trip.FromStation ➔ @trip.ToStation</td>
                            <td>@trip.SeatNumber</td>
                            <td>¥@trip.Price</td>
                            <td class="text-muted small">@trip.Notes</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

@code {
    private List<TripRecordDto>? trips;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            trips = await Http.GetFromJsonAsync<List<TripRecordDto>>("api/trips");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"加载失败: {ex.Message}");
        }
    }
}