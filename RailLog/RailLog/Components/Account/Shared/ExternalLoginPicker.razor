@using Microsoft.AspNetCore.Authentication
@using Microsoft.AspNetCore.Identity
@using RailLog.Data

@inject SignInManager<ApplicationUser> SignInManager
@inject IdentityRedirectManager RedirectManager

@if (externalLogins.Length == 0)
{
    <div>
        <MudText Typo="Typo.body2">
            There are no external authentication services configured. See this <MudLink Href="https://go.microsoft.com/fwlink/?LinkID=532715" Target="_blank">article
            about setting up this ASP.NET application to support logging in via external services</MudLink>.
        </MudText>
    </div>
}
else
{
    <form action="Account/PerformExternalLogin" method="post">
        <AntiforgeryToken />
        <input type="hidden" name="ReturnUrl" value="@ReturnUrl" />
        <div class="d-flex flex-wrap gap-2">
            @foreach (var provider in externalLogins)
            {
                <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" name="provider" value="@provider.Name" title="@($"Log in using your {provider.DisplayName} account")">@provider.DisplayName</MudButton>
            }
        </div>
    </form>
}

@code {
    private AuthenticationScheme[] externalLogins = [];

    [SupplyParameterFromQuery]
    private string? ReturnUrl { get; set; }

    protected override async Task OnInitializedAsync()
    {
        externalLogins = (await SignInManager.GetExternalAuthenticationSchemesAsync()).ToArray();
    }
}
